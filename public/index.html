 
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Main</title>

  <script src="katex-custom-element.js"></script>

   <link rel="stylesheet" href="./katex.min.css"> 

   <title>Scripta Demo</title>

  <script src="./main.js"></script>

  <script type="module" src="./tauri.js"></script>


</head>

<body>

<div id="main"></div>

<script type="module">

    import {pi} from './tauri.js'

		var root = document.getElementById('main');
		var app = Elm.Main.init({node: root, flags:  {  }});
    init(app);

    console.log("pi =", pi)

    app.ports.sendDocument.subscribe(data => {
      console.log("I want to save", data.name);
      console.log("BASE DIR", window.__TAURI__.fs.BaseDirectory.Desktop)
      window.__TAURI__.fs.writeTextFile(
        { path: data.path, contents: data.content },
        {
          dir: window.__TAURI__.fs.BaseDirectory.Desktop
        }
      )

    });



     // import { readTextFile, BaseDirectory } from '@tauri-apps/api/fs';
    // Read the text file in the `$APPDIR/app.conf` path
    // const contents = await readTextFile('app.conf', { dir: BaseDirectory.App });

    app.ports.readPreferences.subscribe((path) => {
      console.log("READ FILE")
      window.__TAURI__.fs.readTextFile('scripta/preferences.txt', { dir: window.__TAURI__.fs.BaseDirectory.Desktop }).then((contents) => {
        if (typeof contents === 'string') {
        
          alert("PREFS: " + contents )

          app.ports.receivePreferences.send({preferences: contents});


        } else { 

          alert("No preferences file found")
        }
        
      })

    });

    // app.ports.listDirectory.subscribe(path => {
    //    console.log("I want to list", path);
    //    const entries =  window.__TAURI__.fs.readDir(path, { dir: window.__TAURI__.fs.BaseDirectory.Desktop, recursive: false });
    //    entries.then(data => console.log("DIR ENTRIES", data))

    // });

    app.ports.listDirectory.subscribe((path) => {
      window.__TAURI__.dialog.open().then((filepath) => {
        if (typeof filepath === 'string') {
          window.__TAURI__.fs.readTextFile(filepath).then((content) => {
            console.log("FILEPATH", filepath)
            // console.log("CONTENT", content)
            app.ports.receiveDocument.send({name: filepath, path: filepath, content: content});
          })
        } else {
          alert("Bad file selection (cancelled?)")
        }
      })

    });

  

</script>

</body>
</html>
