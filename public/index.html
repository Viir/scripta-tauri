 
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Main</title>

  <script src="katex-custom-element.js"></script>

   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"> 

  <!-- <link rel="stylesheet" href="katex.min.css" > -->

  <script defer src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script>

  <title>Scripta Demo</title>

  <script src="./main.js"></script>

  <script type="module" src="./tauri.js"></script>


</head>

<body>

<div id="main"></div>

<script type="module">

    import {pi} from './tauri.js'

		var root = document.getElementById('main');
		var app = Elm.Main.init({node: root, flags:  {  }});
    init(app);

    console.log("pi =", pi)

    app.ports.sendDocument.subscribe(data => {
      console.log("I want to save", data.name);
      console.log("BASE DIR", window.__TAURI__.fs.BaseDirectory.Desktop)
      window.__TAURI__.fs.writeTextFile(
        { path: "scripta/" + data.name, contents: data.content },
        {
          dir: window.__TAURI__.fs.BaseDirectory.Desktop
        }
      )

    });

    // app.ports.listDirectory.subscribe(path => {
    //    console.log("I want to list", path);
    //    const entries =  window.__TAURI__.fs.readDir(path, { dir: window.__TAURI__.fs.BaseDirectory.Desktop, recursive: false });
    //    entries.then(data => console.log("DIR ENTRIES", data))

    // });

    app.ports.listDirectory.subscribe((path) => {
      window.__TAURI__.dialog.open().then((filepath) => {
        if (typeof filepath === 'string') {
          window.__TAURI__.fs.readTextFile(filepath).then((content) => {
            console.log("CONTENT", content)
          })
        } else {
          alert("Multiple files chosen, but should be only one file!")
        }
      })

    });

    // open().then((filepath) => {
    //     if (typeof filepath === 'string') {
    //       readTextFile(filepath).then((content) => {
    //         app.ports.interopToElm.send({
    //           tag: "gotFileChoice",
    //           data: { path: filepath, content }
    //         })
    //       })
    //     } else {
    //       alert("Multiple files chosen, but should be only one file!")
    //     }
    //   })


    // import { readTextFile, BaseDirectory } from '@tauri-apps/api/fs';
    // Read the text file in the `$APPDIR/app.conf` path
    // const contents = await readTextFile('app.conf', { dir: BaseDirectory.App });

    // import { readDir, BaseDirectory } from '@tauri-apps/api/fs';
    // // Reads the `$APPDIR/users` directory recursively
    // const entries = await readDir('users', { dir: BaseDirectory.App, recursive: true });

    // function processEntries(entries) {
    //   for (const entry of entries) {
    //     console.log(`Entry: ${entry.path}`);
    //     if (entry.children) {
    //       processEntries(entry.children)
    //     }
    //   }
    // }

</script>

</body>
</html>
